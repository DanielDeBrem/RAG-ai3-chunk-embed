# =====================================
# CLINE RULES – Daan's RAG-cluster
# =====================================

# ---------- ROLE SPLIT ----------

# AI-3 (10.0.1.44) – "Datafabriek"
# - Focus: document intake, slimme chunking, metadata-verrijking, embeddings, reranking.
# - Hier komen:
#   - Python libs voor parsing (pdfplumber, pymupdf, docling/mineru later, etc.).
#   - Chunking + graph / parent-child structuur.
#   - Embedding pipeline (BGE-M3 e.d.).
#   - Reranker pipeline.
#   - Vector store layer (Chroma of FAISS + evt. MySQL metadata).

# AI-4 (10.0.1.227) – "Daily Chat"
# - Focus: orchestratie + LLM-chatlaag.
# - Hier komen:
#   - Python backend / service die:
#       - queries naar AI-3 stuurt (search + rerank).
#       - context ophaalt en doorstuurt naar LLM (Ollama / HF).
#   - prompt-templates, tools, agents.
#   - MySQL of andere metadata-db voor vragen/antwoorden/logging.

# ---------- ALGEMENE REGELS ----------

1. Raak GEEN systeemfiles aan
   - Nooit editen:
     - /etc/*
     - /usr/*
     - /var/*
     - /boot, /lib, /lib64
   - Geen `apt upgrade`, geen distro-wijzigingen, geen kernel-/driver-installaties.
   - Geen wijzigingen aan ~/.bashrc, ~/.profile zonder expliciete vraag van de gebruiker.

2. Geen Docker meer aanraken voor dit project
   - Geen nieuwe docker-compose files maken of bestaande aanpassen.
   - Geen nieuwe containers deployen voor deze RAG-pipeline.
   - Eventuele bestaande Docker-config alleen lezen als referentie, niet wijzigen.

3. Resource-bewust werken
   - Ga er NIET van uit dat je alle GPU’s mag claimen.
   - Als je scripts schrijft:
     - Maak batchgroottes en modelnamen configureerbaar via een config (.yaml/.toml/.env).
     - Gebruik duidelijke CLI-flags (`--batch-size`, `--max-chunk-tokens`, `--device`).
   - Geen brute-force scan over grote directories (data/, models/, etc.) tenzij expliciet gevraagd.

4. Veilig met secrets
   - Gebruik .env / config-bestanden voor:
     - DB credentials
     - API keys
     - interne hostnames/ports
   - Nooit secrets in code hardcoden.
   - Nooit secrets in logs printen.

5. Python en tooling
   - Default naar Python 3 (liefst 3.10+).
   - Gebruik venv per project (`.venv/` in de projectroot).
   - Genereer requirements.txt OF pyproject.toml:
     - Dependencies duidelijk en minimaal houden.
   - Geen zware frameworks tenzij zinvol (bijv. FastAPI voor API, niet “zomaar” Django).

6. Structuur RAG-projecten
   - AI-3 projectstructuur (suggestie):
     - src/
       - ingest/           -> loaders, OCR hooks, normalisatie
       - chunking/         -> slimme chunkers + graph logic
       - embedding/        -> embedding-clients (BGE-M3, Ollama, HF)
       - rerank/           -> rerank-clients
       - vectorstore/      -> Chroma/FAISS + index beheer
       - utils/
     - tests/
     - scripts/            -> CLI entrypoints (ingest_dir, rebuild_index, etc.)
   - AI-4 projectstructuur (suggestie):
     - src/
       - api/              -> HTTP endpoints (FastAPI e.d.)
       - orchestration/    -> query-planning, routeren naar AI-3/thor
       - llm/              -> Ollama/HF-clients, prompt-templates
       - tools/            -> helper tools (kvstore, search, calculators)
       - utils/
     - tests/
   - Cline mag nieuwe modules aanmaken binnen deze structuur, geen random spaghetti.

7. Vector store keuze
   - Start simpel:
     - ChromaDB of FAISS als vectorlaag.
     - MySQL/Postgres voor metadata / logging / audit.
   - Cline:
     - Bouw adapters zodat we later kunnen switchen zonder heel de pipeline om te gooien
       (bv. `VectorStore` interface + `ChromaStore`, `FaissStore` implementaties).

8. Runtimes / services
   - Maak scripts als:
     - `python -m src.scripts.ingest_dir ...`
     - `python -m src.scripts.build_index ...`
     - `python -m src.api.server` (FastAPI/Uvicorn)
   - Geen systemd units of background services aanpassen/maken zonder expliciete vraag.

9. Logging / debug
   - Gebruik logging-module, geen `print`-spaghetti:
     - DEBUG voor ontwikkel-informatie
     - INFO voor pipeline-stappen
     - WARNING/ERROR voor fouten
   - Log paths naar `logs/` onder projectroot, niet naar /var/log/.

10. Testbaarheid
   - Waar mogelijk:
     - Kleine, pure Python functies schrijven met duidelijke input/output.
     - Unit tests toevoegen in tests/ met pytest.

# ---------- SPECIFIEK VOOR AI-3 (DATAFABRIEK) ----------

- Focus op:
  - Document loaders (PDF, DOCX, afbeeldingen later).
  - Metadata extractie (titel, datum, entiteiten, bedragen, relaties).
  - Agentic chunking:
    - Chunk-level waarde (elk chunk vertelt “iets” afgerond).
    - Parent-child structuur (chunks verwijzen naar sectie / pagina / document).
  - Embeddings via BGE-M3 (HF / Infinity / eigen service).
  - Rerankers via aparte module.

- Cline mag:
  - Python-CLI’s maken voor:
    - `ingest_document`
    - `ingest_directory`
    - `rebuild_index`
  - Config-bestanden ontwerpen voor pipeline parameters.

# ---------- SPECIFIEK VOOR AI-4 (DAILY CHAT) ----------

- Focus op:
  - Query → retrieval (RPC / HTTP naar AI-3).
  - Retrieval → context-bouw (prompt assembly).
  - Context → LLM (Ollama / HF).
  - Eventueel routering naar een zwaarder model (Thor) in een latere fase.

- Cline mag:
  - Een eenvoudige API bouwen (FastAPI o.i.d.) voor:
    - `/query` → tekstvraag
    - `/health` → healthcheck
  - Integraties schrijven naar:
    - Ollama HTTP API
    - AI-3 retrieval API (die jij later draait).

# ---------- DINGEN DIE CLINE NIET MAG DOEN ----------

- Geen:
  - `rm -rf` buiten de projectroot.
  - Format / wijzigen van schijven.
  - Aanpassen van netwerkinterfaces, firewalls, iptables, ufw.
  - Aanpassen van NVIDIA drivers / CUDA installatie.
  - Vernaggelen van bestaande services (Home Assistant, RAGflow-legacy, etc.).

# ---------- STIJL ----------

- Code:
  - Duidelijke namen, type hints waar handig.
  - Korte, gefocuste functies.
  - Docstrings voor belangrijke modules en pipelines.
- Config:
  - Geen magic numbers in de code; alles in config of constants.
